# PARALLEL OK 2 #
dimension 2

domaine dom_C_O2         # domaine dissou O2 CLc-MB #

# BEGIN MESH #
Mailler dom_C_O2
{
	Pave Cavite
	{
		Origine 0. 0.
		Nombre_de_Noeuds  21 36
		Longueurs 2 35
	}
	{
		Bord Gauche X = 0.	0 <= Y <= 35    
		Bord Droit  X = 2	0 <= Y <= 35    
		Bord Haut   Y = 35	0 <= X <= 2   
		Bord Bas    Y = 0   0 <= X <= 2   
	}
}
Transformer dom_C_O2 x*1e-5 y*1e-6
Trianguler_H dom_C_O2

Sous_zone CLc_C_O2 
associer CLc_C_O2 dom_C_O2
Lire CLc_C_O2 { fonction_sous_zone (y_GE_(25.e-6))_AND_(y_LE_(35.e-6)) }
# END MESH #

# BEGIN PARTITION
Partition dom_C_O2
{
	Partition_tool tranche { tranches 2 1 }
	Larg_joint 1
	zones_name dom_C_O2
}
End
END PARTITION #

# BEGIN SCATTER
Scatter dom_C_O2.Zones dom_C_O2
Sous_Zone CLc_C_O2
Associate CLc_C_O2 dom_C_O2
Read CLc_C_O2 { Fichier CLc_C_O2.ssz }
END SCATTER #

# dissous de O2 dans Nafion #
# equation: dC_O2/dt + 1/(1-por_naf)eps_naf.div(-D_O2_eff.grad(C_O2)) = 1/(1-por_naf)eps_naf.(Sa_O2 + S_O2) #
Pb_Conduction pb_C_O2

# schema discretisation #
VEFPrep1B dis

Scheme_euler_implicit sch
Read sch
{
	tinit 0
	tmax 0.2
	dt_impr 0.001
	dt_sauv 0.2
	nb_pas_dt_max 500
	seuil_statio 1e-4
	max_iter_implicite 50
    solveur implicite {          
	     solveur  petsc cholesky { } 
    }
    facsec 1
}

# Nafion O2 #
Solide prop_C_O2
Read prop_C_O2
{
	rho     champ_uniforme 1 1.
	Cp      champ_uniforme 1 1.
	lambda  champ_uniforme 1 1.e-10 # D_O2 = 3.1e-7*exp(-2768./353.15) = 1.22e-10 #
}

# champ de diffusion effective diffusion_nafion, normal D_i_naf, flux N_i_naf #
Loi_Fermeture_Diffusion_Nafion loi_nafion_O2
associate pb_C_O2 loi_nafion_O2

Associate pb_C_O2 dom_C_O2
Associate pb_C_O2 prop_C_O2

Associate pb_C_O2 sch

Discretize pb_C_O2 dis

# champ de diffusion effective O2 diffusion_nafion, normal D_i_naf, flux N_i_naf #
Read loi_nafion_O2
{
   nom_espece O2
   temperature Champ_Uniforme 1 353.15
   por_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 0.0 CLc_C_O2 0.47 }		# porosite de Nafion #
   eps_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 1. CLc_C_O2 0.2 }		# ionomer proportionnel de Nafion #
   tor_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 1. CLc_C_O2 1.3 }		# tortuosite de Nafion # 
}

# dissous O2 dans Nafion #
read pb_C_O2
{
   Conduction
	{
		diffusion { nafion { 
		    diffusivity_fieldname diffusion_nafion 
		    por_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 0.0 CLc_C_O2 0.47 }		# porosite de Nafion #
            eps_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 1. CLc_C_O2 0.2 }		# ionomer proportionnel de Nafion #
		    } 
		}
		
		# initial_conditions { temperature Champ_fonc_reprise prerun_variant_pb_C_O2.xyz pb_C_O2 temperature last_time } #
		# H_O2 = (1/1.01325e5)*exp(5.88e3/(R*T))=7.311884466144632e-05; Ceq = cRTH=9*8.314*353.15*H_O2=1.93 #
		initial_conditions { temperature Champ_Uniforme 1 1.93 }
		initial_conditions { temperature Champ_Uniforme 1 1e-3 }
		
		boundary_conditions {
			Gauche  paroi_adiabatique
			Droit   paroi_adiabatique
			Haut    paroi_adiabatique
			Bas     paroi_temperature_imposee Champ_Front_Uniforme 1 0. # C_O2 at I_MB_CLa = 0 #
		}
	
		sources {     
		    # source term S comming from the electrochemical reactions in CL #
		    Source_term_nafion_reaction
		    {
		        nom_espece O2
		        nom_CLc CLc_C_O2
		        # nom_pb_phi pb_phi
		        nom_champ_ir ir
		        nom_champ_ip ip #
		        reacCurrent champ_uniforme_morceaux dom_C_O2 1 { defaut 0.0 CLc_C_O2 3e8 }	# current density of the reaction A/m3 #
		        permCurrent champ_uniforme 1 0.
		        por_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 0.0 CLc_C_O2 0.47 }		# porosite de Nafion #
                eps_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 1. CLc_C_O2 0.2 }		# ionomer proportionnel de Nafion #
		    }
		    # puissance_thermique champ_uniforme_morceaux dom_C_O2 1 { defaut 0.0 CLc_C_O2 -1000 } #
		    ,
		    Source_Term_Nafion_diffusion 
		    {
		        nom_espece O2           # in the list of H2 O2 N2 vap #
		        nom_domaine dom_C_O2
		        nom_CLc CLc_C_O2
		        por_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 0.0 CLc_C_O2 0.47 }		# porosite de Nafion #
                eps_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 1. CLc_C_O2 0.2 }		# ionomer proportionnel de Nafion #
		        gamma_CL champ_uniforme_morceaux dom_C_O2 1 { defaut 0.0 CLc_C_O2 2.5e7 }
		        nom_pb_C pb_C_O2
		        nom_champ_C temperature
		        nom_champ_D D_i_naf
		        # nom_pb_T pb_T
		        nom_champ_T temperature #
		        temperature Champ_Uniforme 1 353.15
		        # nom_pb_ci_cathode pb_ci_cathode
		        nom_champ_ci_cathode concentration #
		        concentration Champ_Uniforme_Morceaux dom_C_O2 1 { defaut 0.0 CLc_C_O2 9. }
		    } 
        }	
    }
    Post_processing
	{
	    probes {
	         Co_seg temperature periode 1e-3 segment 36 10e-6 0 10e-6 35e-6
	         Co_pts temperature periode 1e-3 points 1 10e-6 12.5e-6
	    }
	    Definition_champs 
	    {
		    Diffusion_O2 operateur_eqn { numero_op 0 source refchamp { pb_champ pb_C_O2 temperature } }
		    S_O2  operateur_eqn { numero_source 0 source refchamp {  pb_champ pb_C_O2 temperature } }
		    Sa_O2  operateur_eqn { numero_source 1 source refchamp {  pb_champ pb_C_O2 temperature } }
	    }
        format lata
        fields dt_post 1e-3
		{
		    temperature som
		    diffusion_nafion elem
		    D_i_naf elem
		    Diffusion_O2 elem
		    S_O2 elem
		    Sa_O2 elem 
		    S elem
		    Ceq som
		}
	}
}

Solve pb_C_O2

End
