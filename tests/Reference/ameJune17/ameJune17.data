dimension 2

domaine dom_ci_cathode  # domaine diffusion multi-especes concentration O2 vap N2 (cathode) GDLc-MPLc-CLc #

domaine dom_ci_anode    # domaine diffusion multi-especes concentration H2 vap N2 (anode) CLa-MPLa-GDLa #

domaine dom_T           # domaine conduction de chaleur Temperature GDLc-MPLc-CLc-MB-CLa-MPLc-GDLa #

domaine dom_C_O2         # domaine dissou O2 CLc-MB #

domaine dom_C_H2         # domaine dissou H2 MB-CLa #

domaine dom_C_H2O        # domaine dissou H2O CL_c-MB-CL_a #

domaine dom_C_N2        # domaine dissou N2 CL_c-MB-CL_a #

domaine dom_phi         # domaine transport ionique phi CL_c-MB-CL_a #

domaine dom_psi         # domaine transport electrique psi GDLc-MPLc-CLc et CLa-MPLc-GDLa #

# BEGIN MESH #
Mailler dom_C_H2
{
	Pave Cavite
	{
		Origine 0. -10.
		Nombre_de_Noeuds  5 8
		Longueurs 2 35
	}
	{
		Bord Gauche X = 0.	-10 <= Y <= 25
		Bord Droit  X = 2	-10 <= Y <= 25
		Bord Haut   Y = 25	 0. <= X <= 2
		Bord Bas    Y = -10  0. <= X <= 2
	}
}
Transformer dom_C_H2 x*1e-5 y*1e-6
Trianguler_H dom_C_H2

Sous_zone dom_C_H2_CLa
associer dom_C_H2_CLa dom_C_H2
Lire dom_C_H2_CLa { fonction_sous_zone (y_GE_(-10.e-6))_AND_(y_LE_(0.0)) }

Mailler dom_T
{
    Pave Cavite
	{
		Origine 0. -250.
		Nombre_de_Noeuds  5 106
		Longueurs 2 525
	}
	{
		Bord Gauche X = 0.	-250 <= Y <= 275
		Bord Droit  X = 2	-250 <= Y <= 275
		Bord Haut   Y = 275	  0. <= X <= 2
		Bord Bas    Y = -250  0. <= X <= 2
	}
}
Transformer dom_T x*1e-5 y*1e-6
Trianguler_H dom_T
Sous_zone dom_T_GDLa
associer dom_T_GDLa dom_T
Lire dom_T_GDLa { fonction_sous_zone (y_GE_(75.e-6)_OR_(y_LE_(-50.e-6))) }

Sous_zone dom_T_MPLa
associer dom_T_MPLa dom_T
Lire dom_T_MPLa { fonction_sous_zone ((y_GE_(35.e-6))_AND_(y_LE_(75.e-6)))_OR_((y_GE_(-50.e-6))_AND_(y_LE_(-10.e-6))) }

Sous_zone dom_T_CLa
associer dom_T_CLa dom_T
Lire dom_T_CLa { fonction_sous_zone (y_GE_(-10.e-6))_AND_(y_LE_(0.0))_OR_((y_GE_(25.e-6))_AND_(y_LE_(35.e-6))) }

Sous_zone dom_T_GDLc
associer dom_T_GDLc dom_T
Lire dom_T_GDLc { fonction_sous_zone (y_GE_(75.e-6)_OR_(y_LE_(-50.e-6))) }

Sous_zone dom_T_MPLc
associer dom_T_MPLc dom_T
Lire dom_T_MPLc { fonction_sous_zone ((y_GE_(35.e-6))_AND_(y_LE_(75.e-6)))_OR_((y_GE_(-50.e-6))_AND_(y_LE_(-10.e-6))) }

Sous_zone dom_T_CLc
associer dom_T_CLc dom_T
Lire dom_T_CLc { fonction_sous_zone (y_GE_(-10.e-6))_AND_(y_LE_(0.0))_OR_((y_GE_(25.e-6))_AND_(y_LE_(35.e-6))) }

Mailler dom_ci_anode
{
	Pave Cavite3
		{
		Origine 0. -250
		Nombre_de_Noeuds  5 51
		Longueurs 2 250
		}
		{
		Bord Gauche X = 0.	  -250 <= Y <= 0
		Bord Droit  X = 2	  -250 <= Y <= 0
		Bord Bas    Y = -250	0. <= X <= 2
		Bord Haut   Y = 0	    0. <= X <= 2
		}
}
Transformer dom_ci_anode x*1e-5 y*1e-6
Trianguler_H dom_ci_anode

Sous_zone dom_ci_anode_MPLa
associer dom_ci_anode_MPLa dom_ci_anode
Lire dom_ci_anode_MPLa { fonction_sous_zone (y_GE_(-50.e-6))_AND_(y_LE_(-10.e-6)) }

Sous_zone dom_ci_anode_CLa
associer dom_ci_anode_CLa dom_ci_anode
Lire dom_ci_anode_CLa { fonction_sous_zone (y_GE_(-10.e-6))_AND_(y_LE_(0.0)) }

Mailler dom_C_O2
{
	Pave Cavite
	{
		Origine 0. 0.
		Nombre_de_Noeuds  5 8
		Longueurs 2 35
	}
	{
		Bord Gauche X = 0.	0 <= Y <= 35
		Bord Droit  X = 2	0 <= Y <= 35
		Bord Haut   Y = 35	0 <= X <= 2
		Bord Bas    Y = 0   0 <= X <= 2
	}
}
Transformer dom_C_O2 x*1e-5 y*1e-6
Trianguler_H dom_C_O2

Sous_zone dom_C_O2_CLc
associer dom_C_O2_CLc dom_C_O2
Lire dom_C_O2_CLc { fonction_sous_zone (y_GE_(25.e-6))_AND_(y_LE_(35.e-6)) }


Mailler dom_ci_cathode
{
	Pave Cavite2
		{
		Origine 0. 25.
		Nombre_de_Noeuds  5 51
		Longueurs 2 250
		}
		{
		Bord Gauche         X = 0.	25. <= Y <= 275
		Bord Droit          X = 2	25. <= Y <= 275
		Bord Haut           Y = 275	0.  <= X <= 2
		Bord Bas            Y = 25 	0.  <= X <= 2
		}
}
Transformer dom_ci_cathode x*1e-5 y*1e-6
Trianguler_H dom_ci_cathode

Sous_zone dom_ci_cathode_MPLc
associer dom_ci_cathode_MPLc dom_ci_cathode
Lire dom_ci_cathode_MPLc { fonction_sous_zone ((y_GE_(35.e-6))_AND_(y_LE_(75.e-6))) }

Sous_zone dom_ci_cathode_CLc
associer dom_ci_cathode_CLc dom_ci_cathode
Lire dom_ci_cathode_CLc { fonction_sous_zone ((y_GE_(25.e-6))_AND_(y_LE_(35.e-6))) }


Mailler dom_C_H2O
{
    Pave Cavite
	{
		Origine 0. -10.
		Nombre_de_Noeuds  5 10
		Longueurs 2 45
	}
	{
		Bord Gauche X = 0.	-10 <= Y <= 35
		Bord Droit  X = 2	-10 <= Y <= 35
		Bord Haut   Y = 35	 0. <= X <= 2
		Bord Bas    Y = -10  0. <= X <= 2
	}
}
Transformer dom_C_H2O x*1e-5 y*1e-6
Trianguler_H dom_C_H2O

Sous_zone dom_C_H2_CLaO
associer dom_C_H2_CLaO dom_C_H2O
Lire dom_C_H2_CLaO { fonction_sous_zone (y_GE_(-10.e-6))_AND_(y_LE_(0.0)) }

Sous_zone dom_C_H20_CLc
associer dom_C_H20_CLc dom_C_H2O
Lire dom_C_H20_CLc { fonction_sous_zone (y_GE_(25.e-6))_AND_(y_LE_(35.e-6)) }

Mailler dom_C_N2
{
    Pave Cavite
	{
		Origine 0. -10.
		Nombre_de_Noeuds  5 10
		Longueurs 2 45
	}
	{
		Bord Gauche X = 0.	-10 <= Y <= 35
		Bord Droit  X = 2	-10 <= Y <= 35
		Bord Haut   Y = 35	 0. <= X <= 2
		Bord Bas    Y = -10  0. <= X <= 2
	}
}
Transformer dom_C_N2 x*1e-5 y*1e-6
Trianguler_H dom_C_N2

Sous_zone dom_C_N2_CLa
associer dom_C_N2_CLa dom_C_N2
Lire dom_C_N2_CLa { fonction_sous_zone (y_GE_(-10.e-6))_AND_(y_LE_(0.0)) }

Sous_zone dom_C_N2_CLc
associer dom_C_N2_CLc dom_C_N2
Lire dom_C_N2_CLc { fonction_sous_zone (y_GE_(25.e-6))_AND_(y_LE_(35.e-6)) }

Mailler dom_phi
{
    Pave Cavite
	{
		Origine 0. -10.
		Nombre_de_Noeuds  5 10
		Longueurs 2 45
	}
	{
		Bord Gauche X = 0.	-10 <= Y <= 35
		Bord Droit  X = 2	-10 <= Y <= 35
		Bord Haut   Y = 35	 0. <= X <= 2
		Bord Bas    Y = -10  0. <= X <= 2
	}
}
Transformer dom_phi x*1e-5 y*1e-6
Trianguler_H dom_phi

Sous_zone dom_phi_CLa
associer dom_phi_CLa dom_phi
Lire dom_phi_CLa { fonction_sous_zone (y_GE_(-10.e-6))_AND_(y_LE_(0.0)) }

Sous_zone dom_phi_CLc
associer dom_phi_CLc dom_phi
Lire dom_phi_CLc { fonction_sous_zone (y_GE_(25.e-6))_AND_(y_LE_(35.e-6)) }

Mailler dom_psi
{
	Pave Cavite2
		{
		Origine 0. 25.
		Nombre_de_Noeuds  5 51
		Longueurs 2 250
		}
		{
		Bord Gauche         X = 0.	25. <= Y <= 275
		Bord Droit          X = 2	25. <= Y <= 275
		Bord Haut           Y = 275	0.  <= X <= 2
		Bord I_MB_CL_c      Y = 25 	0.  <= X <= 2
		}
,
    Pave Cavite3
		{
		Origine 0. -250
		Nombre_de_Noeuds  5 51
		Longueurs 2 250
		}
		{
		Bord Gauche X = 0.	  -250 <= Y <= 0
		Bord Droit  X = 2	  -250 <= Y <= 0
		Bord Bas    Y = -250	0. <= X <= 2
		Bord I_MB_CL_a    Y = 0	0. <= X <= 2
		}
}
Transformer dom_psi x*1e-5 y*1e-6
Trianguler_H dom_psi

Sous_zone dom_psi_GDLa
associer dom_psi_GDLa dom_psi
Lire dom_psi_GDLa { fonction_sous_zone (y_LE_(-50.e-6)) }

Sous_zone dom_psi_GDLc
associer dom_psi_GDLc dom_psi
Lire dom_psi_GDLc { fonction_sous_zone (y_GE_(75.e-6)) }

Sous_zone dom_psi_MPLa
associer dom_psi_MPLa dom_psi
Lire dom_psi_MPLa { fonction_sous_zone ((y_GE_(-50.e-6))_AND_(y_LE_(-10.e-6))) }

Sous_zone dom_psi_MPLc
associer dom_psi_MPLc dom_psi
Lire dom_psi_MPLc { fonction_sous_zone ((y_GE_(35.e-6))_AND_(y_LE_(75.e-6))) }

Sous_zone dom_psi_CLa
associer dom_psi_CLa dom_psi
Lire dom_psi_CLa { fonction_sous_zone (y_GE_(-10.e-6))_AND_(y_LE_(0.0)) }

Sous_zone dom_psi_CLc
associer dom_psi_CLc dom_psi
Lire dom_psi_CLc { fonction_sous_zone (y_GE_(25.e-6))_AND_(y_LE_(35.e-6)) }
# END MESH #

# conduction de la chaleur #
# modele de la chaleur: dT/dt = 1/rhoCp.div(-lambda.gradT) + 1/rhoCp.Source #
Pb_Conduction pb_T

# transport multi-especes O2 vap N2 dans cathode #
Pb_hydraulique_Concentration pb_ci_cathode

# transport multi-especes H2 vap N2 dans anode #
Pb_hydraulique_Concentration pb_ci_anode

# dissous de O2 dans Nafion #
# equation: dC_O2/dt + 1/(1-por_naf)eps_naf.div(-D_O2_eff.grad(C_O2)) = 1/(1-por_naf)eps_naf.(Sa_O2 + S_O2) #
Pb_Conduction pb_C_O2

# dissous de H2 dans Nafion #
# equation: dC_H2/dt + 1/(1-por_naf)eps_naf.div(-D_H2_eff.grad(C_H2)) = 1/(1-por_naf)eps_naf.(Sa_H2 + S_H2) #
Pb_Conduction pb_C_H2

# dissous de H2O dans Nafion #
# equation: dC_H2O/dt + 1/(1-por_naf)eps_naf.div(-D_w.grad(C)) = 1/(1-por_naf)eps_naf.(Sd_H2O + S_H2O + Sosmotic_H2O) #
Pb_Conduction pb_C_H2O

# dissous de N2 dans Nafion #
# equation: dC_N2/dt + 1/(1-por_naf)eps_naf.div(-D_w.grad(C)) = 1/(1-por_naf)eps_naf.(Sa_N2) #
Pb_Conduction pb_C_N2

# transport ionique #
# equation dphi/dt = 1/Cdl.div(-kappa.grad(phi)) + 1/Cdl.Si avec Si = ir #
Pb_Conduction pb_phi

# transport electrique #
# equation dpsi/dt = 1/Cdl.div(-sigma.grad(psi)) + 1/Cdl.Se avec Se = -ir #
Pb_Conduction pb_psi

# schema discretisation #
VEFPrep1B dis

Scheme_euler_implicit sch
Read sch
{
	tinit 0
	tmax 2.
	dt_impr 0.001
	dt_sauv 100
	nb_pas_dt_max 20
	seuil_statio 1e-5
	max_iter_implicite 50
    solveur implicite {
         # solveur  petsc gmres { Precond diag { } seuil 1e-12 } #
	     # solveur  petsc bicgstab { seuil 1e-12 impr precond  pilut { level 30 epsilon 0.01   } } #
	     solveur  petsc cholesky { }
	     seuil_convergence_implicite 1000.
    }
    facsec 1e12
    facsec_max 1e13
}

# proprietaire solide pour la chaleur isotrope, homogene #
Solide prop_T
Read prop_T
{
    # masse volumique kg/m3 #
    rho     champ_uniforme 1 2250.
    # capacite thermique J/kg/K #
    Cp      champ_uniforme 1 708.
    # conductivite thermique W/m/K #
    lambda  champ_uniforme_morceaux dom_T 1 { defaut 0.186
        dom_T_GDLa 0.35 dom_T_MPLa 10. dom_T_CLa 3.
        dom_T_GDLc 0.35 dom_T_MPLc 10. dom_T_CLc 3.
    }
}

# proprietaire fluid pour la diffusion multi-especes cathode O2 vap N2 #
Fluide_Incompressible fluide_cathode
Read fluide_cathode
{
    mu	Champ_Uniforme 1 1.85e-5	# Dynamic viscosity kg/m/s #
    rho	Champ_Uniforme 1 1.17		# Density kg/m3 #
    beta_co Champ_Uniforme 3 1e-4 1e-4 1e-4 # Volume expansion coefficient values in concentration #
}
# diffusion coefficient pour multi-especes #
Constituant c_cathode
Read c_cathode
{
  coefficient_diffusion Champ_Uniforme 3 5e-2 5e-2 5e-2
}
associate pb_ci_cathode c_cathode

# champ de diffusion matriciel multi-scalaire pemfc_cas2  #
loi_fermeture_pemfc_cas2 loi_diffusion_cathode
associer pb_ci_cathode loi_diffusion_cathode

# proprietaire fluid pour la diffusion multi-especes anode H2 vap N2 #
Fluide_Incompressible fluide_anode
Read fluide_anode
{
    mu	Champ_Uniforme 1 1.85e-5	# Dynamic viscosity kg/m/s #  # depend de c et de T #
    rho	Champ_Uniforme 1 1.17		# Density kg/m3 # # depend de c et de T #
    beta_co Champ_Uniforme 3 1e-4 1e-4 1e-4 # Volume expansion coefficient values in concentration #
}
# diffusion coefficient pour multi-especes #
Constituant c_anode
Read c_anode
{
  coefficient_diffusion Champ_Uniforme 3 5e-2 5e-2 5e-2
}
associate pb_ci_anode c_anode

# champ de diffusion matriciel multi-scalaire pemfc_cas2  #
loi_fermeture_pemfc_cas2 loi_diffusion_anode
associate pb_ci_anode loi_diffusion_anode

# Nafion H2 #
Solide prop_C_H2
Read prop_C_H2
{
	rho     champ_uniforme 1 1.
	Cp      champ_uniforme 1 1.
	lambda  champ_uniforme 1 1.e-10 # D_H2 = 4.1e-7*exp(-2602./353.15) = 2.59e-10 #
}

# coefficient de diffusion effective diffusion_nafion, diffusion normal D_i_naf #
Loi_Fermeture_Diffusion_Nafion loi_nafion_H2
associate pb_C_H2 loi_nafion_H2

# Nafion O2 #
Solide prop_C_O2
Read prop_C_O2
{
	rho     champ_uniforme 1 1.
	Cp      champ_uniforme 1 1.
	lambda  champ_uniforme 1 1.e-10 # D_O2 = 3.1e-7*exp(-2768./353.15) = 1.22e-10 #
}

# champ de diffusion effective diffusion_nafion, normal D_i_naf, flux N_i_naf #
Loi_Fermeture_Diffusion_Nafion loi_nafion_O2
associate pb_C_O2 loi_nafion_O2

# Nafion H2O #
Solide prop_C_H2O
Read prop_C_H2O
{
	rho     champ_uniforme 1 1.
	Cp      champ_uniforme 1 1.
	lambda  champ_uniforme 1 1.e-10 # D_H2O = (6.707e-8*10000./2036.+6.387e-7)*exp(-2416./353.15) = 1.035e-09 #
}

# champ de diffusion effective diffusion_nafion, normal D_i_naf, flux N_i_naf #
Loi_Fermeture_Diffusion_Nafion loi_nafion_H2O
associate pb_C_H2O loi_nafion_H2O

# Nafion N2 #
Solide prop_C_N2
Read prop_C_N2
{
	rho     champ_uniforme 1 1.
	Cp      champ_uniforme 1 1.
	lambda  champ_uniforme 1 1.e-10 # D_N2 = 4.24e-6*exp(-2246./353.15) = 7.33e-09 #
}

# champ de diffusion effective diffusion_nafion, normal D_i_naf, flux N_i_naf #
Loi_Fermeture_Diffusion_Nafion loi_nafion_N2
associate pb_C_N2 loi_nafion_N2


# proprietaire pour le transport ionique #
Solide prop_phi
Read prop_phi
{
    rho     champ_uniforme 1 1.
    Cp      champ_uniforme 1 1.
    lambda  champ_uniforme_morceaux dom_phi 1 { defaut 12. dom_phi_CLa 1.5 dom_phi_CLc 1.5 }    # negliger l'anisotropie #
    # lambda doit etre remplace par kappa <- Loi_Fermeture_transport_ionique #
}

# loi fermeture pour kappa (conductivite), I_i (courant), eta, Erev, i0, ir, ip, qreac, qperm, dir_dphi, dirdcH2, dirdcO2, dirdcH2O  #
Loi_Fermeture_transport_ionique loi_trans_ion
associer pb_phi loi_trans_ion

# proprietaire pour le transport electrique #
Solide prop_psi
Read prop_psi
{
    rho     champ_uniforme 1 1.
    Cp      champ_uniforme 1 1.
    lambda  champ_uniforme_morceaux dom_psi 1 { defaut 20 dom_psi_GDLa 23. dom_psi_GDLc 23. dom_psi_MPLa 200. dom_psi_MPLc 200. }    # negliger l'anisotropie #
}

Associate pb_T dom_T
Associate pb_T prop_T

Associate pb_ci_cathode dom_ci_cathode
associate pb_ci_cathode fluide_cathode

Associate pb_ci_anode dom_ci_anode
associate pb_ci_anode fluide_anode

Associate pb_C_H2 dom_C_H2
Associate pb_C_H2 prop_C_H2

Associate pb_C_O2 dom_C_O2
Associate pb_C_O2 prop_C_O2

Associate pb_C_H2O dom_C_H2O
Associate pb_C_H2O prop_C_H2O

Associate pb_C_N2 dom_C_N2
Associate pb_C_N2 prop_C_N2

Associate pb_phi dom_phi
Associate pb_phi prop_phi

Associate pb_psi dom_psi
Associate pb_psi prop_psi

Probleme_Couple pbc
Associate pbc pb_T
Associate pbc pb_C_O2
Associate pbc pb_C_H2
Associate pbc pb_C_H2O
Associate pbc pb_C_N2
Associate pbc pb_ci_cathode
Associate pbc pb_ci_anode
Associate pbc pb_phi
Associate pbc pb_psi

Associate pbc sch

Discretize pbc dis

read loi_diffusion_cathode
{
    # tortuosite -> anisotropy: need to do #
    tor champ_uniforme_morceaux dom_ci_cathode 1 { defaut 3. dom_ci_cathode_MPLc 1. dom_ci_cathode_CLc 1.5 }
    # porosite -> anisotropy: need to do #
    por champ_uniforme_morceaux dom_ci_cathode 1 { defaut 0.63 dom_ci_cathode_MPLc 1. dom_ci_cathode_CLc 0.47 }
    # pore radius [m] #
    Rp  champ_uniforme_morceaux dom_ci_cathode 1 { defaut 1e-5 dom_ci_cathode_MPLc 1.e-6 dom_ci_cathode_CLc 1e-8 }
    # permeabilite [m2] -> anisotropy: need to do #
    K  champ_uniforme_morceaux dom_ci_cathode 1 { defaut 4.2e-12 dom_ci_cathode_MPLc 1.e-12 dom_ci_cathode_CLc 1.e-12 }
    # Masse molaires de gaz melange O2 vap N2 #
    masses_molaires 3 32e-3 18e-3 28e-3
}

read loi_diffusion_anode
{
    # tortuosite -> anisotropy: need to do #
    tor champ_uniforme_morceaux dom_ci_anode 1 { defaut 3. dom_ci_anode_MPLa 1. dom_ci_anode_CLa 1.5 }
    # porosite -> anisotropy: need to do #
    por champ_uniforme_morceaux dom_ci_anode 1 { defaut 0.63 dom_ci_anode_MPLa 1. dom_ci_anode_CLa 0.47 }
    # pore radius [m] #
    Rp  champ_uniforme_morceaux dom_ci_anode 1 { defaut 1e-5 dom_ci_anode_MPLa 1.e-6 dom_ci_anode_CLa 1e-8 }
    # permeabilite [m2] -> anisotropy: need to do #
    K  champ_uniforme_morceaux dom_ci_anode 1 { defaut 4.2e-12 dom_ci_anode_MPLa 1.e-12 dom_ci_anode_CLa 1.e-12 }
    # Masse molaires de gaz melange H2 vap N2 #
    masses_molaires 3 2e-3 18e-3 28e-3
}

# champ de diffusion effective O2 diffusion_nafion, normal D_i_naf, flux N_i_naf #
Read loi_nafion_O2
{
   nom_espece O2
   T_0 		353.15		# default value #
   por_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 0.0 dom_C_O2_CLc 0.47 }		# porosite de Nafion #
   eps_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 1. dom_C_O2_CLc 0.2 }		# ionomer proportionnel de Nafion #
   tor_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 1. dom_C_O2_CLc 1.3 }		# tortuosite de Nafion #
   nom_pb_T pb_T
   nom_champ_T temperature
   CSO3 2036.
   nom_champ_Ceq Ceq # pour initialiser C_O2 = Ceq_O2 #
}

# champ de diffusion effective de H2 diffusion_nafion, normal D_i_naf, flux N_i_naf #
Read loi_nafion_H2
{
   nom_espece H2
   T_0 		353.15		# default value #
   por_naf champ_uniforme_morceaux dom_C_H2 1 { defaut 0.0 dom_C_H2_CLa 0.47 }	# porosite de Nafion : CL 0.47, MB 0 #
   eps_naf champ_uniforme_morceaux dom_C_H2 1 { defaut 1. dom_C_H2_CLa 0.2	}	# ionomer proportionnel de Nafion: CA 0.2, MB 1 #
   tor_naf champ_uniforme_morceaux dom_C_H2 1 { defaut 1. dom_C_H2_CLa 1.5	}	# tortuosite de Nafion #
   nom_pb_T pb_T
   nom_champ_T temperature
   CSO3 2036.
   nom_champ_Ceq Ceq # pour initialiser C_H2 = Ceq_H2 #
}

# champ de diffusion effective  H20 diffusion_nafion, normal D_i_naf, flux N_i_naf #
Read loi_nafion_H2O
{
   nom_espece H2O
   T_0 		353.15		# default value #
   por_naf 	champ_uniforme_morceaux dom_C_H2O 1 { defaut 0. dom_C_H2_CLaO 0.47 dom_C_H20_CLc 0.47 }		# porosite de Nafion #
   eps_naf 	champ_uniforme_morceaux dom_C_H2O 1 { defaut 1. dom_C_H2_CLaO 0.2 dom_C_H20_CLc 0.2 }		# ionomer proportionnel de Nafion #
   tor_naf 	champ_uniforme_morceaux dom_C_H2O 1 { defaut 1. dom_C_H2_CLaO 1.5 dom_C_H20_CLc 1.3 }		# tortuosite de Nafion #
   nom_pb_T pb_T
   nom_champ_T temperature
   CSO3 2036.
   nom_champ_Ceq Ceq # pour initialiser C_H2O = Ceq_H2O #
}

# champ de diffusion effective N2 diffusion_nafion, normal D_i_naf, flux N_i_naf #
Read loi_nafion_N2
{
   nom_espece N2
   T_0 		353.15		# default value #
   por_naf 	champ_uniforme_morceaux dom_C_N2 1 { defaut 0. dom_C_N2_CLa 0.47 dom_C_N2_CLc 0.47 }		# porosite de Nafion #
   eps_naf 	champ_uniforme_morceaux dom_C_N2 1 { defaut 1. dom_C_N2_CLa 0.2 dom_C_N2_CLc 0.2 }		# ionomer proportionnel de Nafion #
   tor_naf 	champ_uniforme_morceaux dom_C_N2 1 { defaut 1. dom_C_N2_CLa 1.5 dom_C_N2_CLc 1.3 }		# tortuosite de Nafion #
   nom_pb_T pb_T
   nom_champ_T temperature
   CSO3 2036.
   nom_champ_Ceq Ceq # pour initialiser C_N2 = Ceq_N2 #
}

Read loi_trans_ion
{
   T_0 		353.15		# default value #
   CSO3 	2036.
   por_naf champ_uniforme_morceaux dom_phi 1 { defaut 0.0 dom_phi_CLa 0.47 dom_phi_CLc 0.47 }	# porosite de Nafion : CL 0.47, MB 0 #
   eps_naf champ_uniforme_morceaux dom_phi 1 { defaut 1. dom_phi_CLa 0.2 dom_phi_CLc 0.2	}	# ionomer proportionnel de Nafion: CA 0.2, MB 1 #
   tor_naf champ_uniforme_morceaux dom_phi 1 { defaut 1. dom_phi_CLa 1.5 dom_phi_CLc 1.3	}		# tortuosite de Nafion #
   nom_ssz_CLc dom_phi_CLc
   nom_ssz_CLa dom_phi_CLa
   nom_pb_T 	pb_T
   nom_champ_T 	temperature
   nom_pb_C_H2 pb_C_H2
   nom_champ_C_H2 temperature
   nom_pb_C_O2 pb_C_O2
   nom_champ_C_O2 temperature
   nom_pb_C_H2O pb_C_H2O
   nom_champ_C_H2O temperature
   nom_pb_psi pb_psi
   nom_champ_psi temperature
   nom_pb_phi pb_phi
   nom_champ_phi temperature
   # newton_max_iter 1000
   newton_threshold 1e-6
   minimal_perturbation_value 1e-12
   percentage_perturbation_for_derivatives 0.01 #
}







# chaleur #
read pb_T
{
    Conduction
	{
	    equation_non_resolue 1
		diffusion { }
		initial_conditions { temperature Champ_Uniforme 1 353.15 }
		Boundary_conditions {
			Gauche  paroi_adiabatique
			Droit   paroi_adiabatique
			Haut    paroi_temperature_imposee Champ_Front_Uniforme 1 353.15
			Bas     paroi_temperature_imposee Champ_Front_Uniforme 1 353.15
		}
		# TO-DO: add the source terms #
    }
    Post_processing
	{
	    Definition_champs
	    {
            diff_T operateur_eqn { numero_op 0 source refchamp {  pb_champ pb_T temperature } }
	    }

		Format lml
		fields dt_post 10
		{
		    TEMPERATURE ELEM
		}
	}
}

# dissous O2 dans Nafion #
read pb_C_O2
{
   Conduction
	{
	    equation_non_resolue 0

		diffusion { nafion {
		    diffusivity_fieldname diffusion_nafion
		    por_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 0.0 dom_C_O2_CLc 0.47 }		# porosite de Nafion #
            eps_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 1. dom_C_O2_CLc 0.2 }		# ionomer proportionnel de Nafion #
		    }
		}

		# initial_conditions { temperature Champ_fonc_reprise prerun_variant_pb_C_O2.xyz pb_C_O2 temperature last_time } #
		# H_O2 = (1/1.01325e5)*exp(5.88e3/(R*T))=7.311884466144632e-05; Ceq = cRTH=9*8.314*353.15*H_O2=1.93 #
		initial_conditions { temperature Champ_Uniforme 1 1.93 }


		boundary_conditions {
			Gauche  paroi_adiabatique
			Droit   paroi_adiabatique
			Haut    paroi_adiabatique
			Bas     paroi_temperature_imposee Champ_Front_Uniforme 1 0. # C_O2 at I_MB_CLc = 0 #
		}

		sources {
		    # source term S comming from the electrochemical reactions in CL #
		    Source_term_nafion_reaction
		    {
		        nom_espece O2
		        nom_CLc dom_C_O2_CLc
		        nom_pb_phi pb_phi
		        nom_champ_ir ir
		        nom_champ_ip ip
		        por_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 0.0 dom_C_O2_CLc 0.47 }		# porosite de Nafion #
                eps_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 1. dom_C_O2_CLc 0.2 }		# ionomer proportionnel de Nafion #
		    }
		    # puissance_thermique champ_uniforme_morceaux dom_C_O2 1 { defaut 0.0 dom_C_O2_CLc -1000 } #
		    ,
		    Source_Term_Nafion_diffusion
		    {
		        nom_espece O2           # in the list of H2 O2 N2 vap #
		        nom_domaine dom_C_O2
		        nom_CLc dom_C_O2_CLc
		        por_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 0.0 dom_C_O2_CLc 0.47 }		# porosite de Nafion #
                eps_naf 	champ_uniforme_morceaux dom_C_O2 1 { defaut 1. dom_C_O2_CLc 0.2 }		# ionomer proportionnel de Nafion #
		        gamma_CL champ_uniforme_morceaux dom_C_O2 1 { defaut 0.0 dom_C_O2_CLc 2.5e7 }
		        C_SO3 2036.
		        nom_pb_C pb_C_O2
		        nom_champ_C temperature
		        nom_champ_D D_i_naf # champ de diffusion #
		        nom_pb_T pb_T
		        nom_champ_T temperature
		        nom_pb_ci_cathode pb_ci_cathode
		        nom_champ_ci_cathode concentration # O2 dans la liste multi-especes O2 vap N2 #
		    }
        }
    }
    Post_processing
	{
	    probes {
	         Co_seg temperature periode 1e-3 segment 36 10e-6 0 10e-6 35e-6
	         Co_pts temperature periode 1e-3 points 1 10e-6 12.5e-6
	    }
	    Definition_champs
	    {
		    Diffusion_O2 operateur_eqn { numero_op 0 source refchamp { pb_champ pb_C_O2 temperature } }
		    S_O2  operateur_eqn { numero_source 0 source refchamp {  pb_champ pb_C_O2 temperature } }
		    Sa_O2  operateur_eqn { numero_source 1 source refchamp {  pb_champ pb_C_O2 temperature } }
	    }
        format lml
        fields dt_post 10
		{
		    temperature elem
		    Diffusion_O2 elem
		    S_O2 elem
		    Sa_O2 elem
		    Ceq elem
		}
	}
}

# dissous concentration H2 dans Nafion #
read pb_C_H2
{
   Conduction
	{
	    equation_non_resolue 0

	    # operateur diffusion: div(-D_eff*gradC) / ((1-por)eps) #
		diffusion { nafion {
		    diffusivity_fieldname diffusion_nafion
		    por_naf champ_uniforme_morceaux dom_C_H2 1 { defaut 0.0 dom_C_H2_CLa 0.47 }	# porosite de Couche Active : 0.47, MB: 0 #
            eps_naf champ_uniforme_morceaux dom_C_H2 1 { defaut 1. dom_C_H2_CLa 0.2	}	# ionomer proportionnel de Nafion: CA 0.2, MB: 1 #
		    }
		}

		# initial_conditions { temperature Champ_fonc_reprise prerun_variant_pb_C_H2.xyz pb_C_H2 temperature last_time } #
		# H_O2 = 7.03e-5 , C_O2 = c_O2.R.T.H = 9*8.314*298*7.03e-5 = 1.6 #
		initial_conditions { temperature Champ_Uniforme 1 1.6 }

		boundary_conditions {
			Gauche  paroi_adiabatique
			Droit   paroi_adiabatique
			Haut    paroi_temperature_imposee Champ_Front_Uniforme 1 0. # C_H2 at I_MB_CLc = 0 #
			Bas     paroi_adiabatique
		}

		sources {
		    # source term S comming from the electrochemical reactions in CL: S_i /((1-por)eps) #
		    Source_term_nafion_reaction
		    {
		        nom_espece H2
		        nom_CLa dom_C_H2_CLa
		        nom_pb_phi pb_phi
		        nom_champ_ir ir
		        nom_champ_ip ip
		        por_naf champ_uniforme_morceaux dom_C_H2 1 { defaut 0.0 dom_C_H2_CLa 0.47 }	# porosite de Couche Active : 0.47, MB: 0 #
                eps_naf champ_uniforme_morceaux dom_C_H2 1 { defaut 1. dom_C_H2_CLa 0.2	}	# ionomer proportionnel de Nafion: CA 0.2, MB: 1 #
		    }
		    # puissance_thermique Champ_Uniforme_Morceaux dom_C_H2 1 { defaut 0 dom_C_H2_CLa -2000 } #
		    ,
		    Source_Term_Nafion_diffusion
		    {
		        nom_espece H2           # in the list of H2 O2 N2 vap #
		        nom_domaine dom_C_H2
		        nom_CLa dom_C_H2_CLa
		        por_naf champ_uniforme_morceaux dom_C_H2 1 { defaut 0.0 dom_C_H2_CLa 0.47 }	# porosite de Couche Active : 0.47, MB: 0 #
                eps_naf champ_uniforme_morceaux dom_C_H2 1 { defaut 1. dom_C_H2_CLa 0.2	}	# ionomer proportionnel de Nafion: CA 0.2, MB: 1 #
		        gamma_CL champ_uniforme_morceaux dom_C_H2 1 { defaut 0.0 dom_C_H2_CLa 1.67e7 }
		        nom_pb_C pb_C_H2
		        nom_champ_C temperature
		        nom_champ_D D_i_naf # champ de diffusion #
		        nom_pb_T pb_T
		        nom_champ_T temperature
		        nom_pb_ci_anode pb_ci_anode
		        nom_champ_ci_anode concentration # H2 dans la liste multi-especes H2 vap N2 #
		    }

        }
    }
    Post_processing
	{
	    probes {
	         Ch_seg temperature periode 1e-6 segment 36 10e-6 -10e-6 10e-6 25e-6
	         Ch_pts temperature periode 1e-6 points 1 10e-6 12.5e-6
	    }
	    Definition_champs
	    {
		    Diffusion_H2 operateur_eqn { numero_op 0 source refchamp { pb_champ pb_C_H2 temperature } }
		    S_H2  operateur_eqn { numero_source 0 source refchamp {  pb_champ pb_C_H2 temperature } }
		    Sa_H2  operateur_eqn { numero_source 1 source refchamp {  pb_champ pb_C_H2 temperature } }
	    }
        format lml
        fields dt_post 10
		{
		    temperature elem
		    Diffusion_H2 elem
		    S_H2 elem
		    Sa_H2 elem
		    Ceq elem
		}
	}
}

# dissous concentration H2O dans Nafion #
read pb_C_H2O
{
   Conduction
	{
	    equation_non_resolue 0

		diffusion { nafion {
		    diffusivity_fieldname diffusion_nafion
		    por_naf 	champ_uniforme_morceaux dom_C_H2O 1 { defaut 0. dom_C_H2_CLaO 0.47 dom_C_H20_CLc 0.47 }		# porosite de Nafion #
            eps_naf 	champ_uniforme_morceaux dom_C_H2O 1 { defaut 1. dom_C_H2_CLaO 0.2 dom_C_H20_CLc 0.2 }		# ionomer proportionnel de Nafion #
		    }
		}

# 		initial_conditions { temperature Champ_fonc_reprise prerun_variant_pb_C_H2O.xyz pb_C_H2O temperature last_time } #
        # Psat = exp(23.1961-3816.44/(353.15-46.13)) = 47358.85813833323 #
        # a = cRT/Psat = 8*8.314*353.15/Psat = 0.4959729546559264 #
        # ld = 0.043+17.81*a-39.85*a*a+36*a*a*a = 3.465752975925316 -> C = CSO3*ld = 7056.27 #
		initial_conditions { temperature champ_uniforme 1 7056.27 }

		boundary_conditions {
			Gauche  paroi_adiabatique
			Droit   paroi_adiabatique
			Haut    paroi_adiabatique
			Bas     paroi_adiabatique
		}

		sources {
		    # source term S comming from the electrochemical reactions in CL #
		    Source_term_nafion_reaction
		    {
		        nom_espece H2O
		        nom_CLc dom_C_H20_CLc
		        nom_CLa dom_C_H2_CLaO
		        nom_pb_phi pb_phi
		        nom_champ_ir ir
		        nom_champ_ip ip
		        por_naf 	champ_uniforme_morceaux dom_C_H2O 1 { defaut 0. dom_C_H2_CLaO 0.47 dom_C_H20_CLc 0.47 }		# porosite de Nafion #
                eps_naf 	champ_uniforme_morceaux dom_C_H2O 1 { defaut 1. dom_C_H2_CLaO 0.2 dom_C_H20_CLc 0.2 }		# ionomer proportionnel de Nafion #
		    }
		    # puissance_thermique Champ_Uniforme_Morceaux dom_C_H2O 1 { defaut 0 dom_C_H2_CLaO 0 dom_C_H20_CLc 2000 } #
		    ,
		    Source_Term_Nafion_diffusion
		    {
		        nom_espece H2O           # in the list of H2 O2 N2 vap #
		        nom_domaine dom_C_H2O
		        nom_CLc dom_C_H20_CLc
		        nom_CLa dom_C_H2_CLaO
		        por_naf 	champ_uniforme_morceaux dom_C_H2O 1 { defaut 0. dom_C_H2_CLaO 0.47 dom_C_H20_CLc 0.47 }		# porosite de Nafion #
                eps_naf 	champ_uniforme_morceaux dom_C_H2O 1 { defaut 1. dom_C_H2_CLaO 0.2 dom_C_H20_CLc 0.2 }		# ionomer proportionnel de Nafion #
		        gamma_CL champ_uniforme_morceaux dom_C_H2O 1 { defaut 0.0 dom_C_H2_CLaO 1.67e7 dom_C_H20_CLc 2.5e7 }
		        C_SO3 2036.
		        nom_pb_C pb_C_H2O
		        nom_champ_C temperature
		        nom_champ_D D_i_naf # champ de diffusion #
		        nom_pb_T pb_T
		        nom_champ_T temperature
		        nom_pb_ci_cathode pb_ci_cathode         # ATTENTION: with H2O need both CL_a and CL_c #
		        nom_champ_ci_cathode concentration      # H2O dans la liste multi-especes O2 vap N2 #
		        nom_pb_ci_anode pb_ci_anode             # ATTENTION: with H2O need both CL_a and CL_c #
		        nom_champ_ci_anode concentration        # H2O dans la liste multi-especes H2 vap N2 #
		    }
		    ,
		    Source_terme_Nafion_electro_osmotic
		    {
		        nom_pb_phi pb_phi
                nom_champ_I I_i
                por_naf champ_uniforme_morceaux dom_C_H2O 1 { defaut 0.0 dom_C_H2_CLaO 0.47 dom_C_H20_CLc 0.47 }	# porosite de Couche Active : 0.47, MB: 0 #
                eps_naf champ_uniforme_morceaux dom_C_H2O 1 { defaut 1. dom_C_H2_CLaO 0.2 dom_C_H20_CLc 0.2	}	# ionomer proportionnel de Nafion: CA 0.2, MB: 1 #
		    }
        }
    }
    Post_processing
	{
	    probes {
	         Ce_seg temperature periode 1e-3 segment 46 10e-6 -10e-6 10e-6 35e-6
	         Ce_pts temperature periode 1e-3 points 1 10e-6 12.5e-6
	    }
	    Definition_champs
	    {
		    Diffusion_H2O operateur_eqn { numero_op 0 source refchamp { pb_champ pb_C_H2O temperature } }
		    S_H2O  operateur_eqn { numero_source 0 source refchamp {  pb_champ pb_C_H2O temperature } }
		    Sd_H2O  operateur_eqn { numero_source 1 source refchamp {  pb_champ pb_C_H2O temperature } }
		    Sosmotic_H2O  operateur_eqn { numero_source 2 source refchamp {  pb_champ pb_C_H2O temperature } }
	    }
        format lml
        fields dt_post 10
		{
		    temperature elem
		    Diffusion_H2O elem
		    S_H2O elem
		    Sd_H2O elem
		    Sosmotic_H2O elem
		    Ceq elem
		}
	}
}

# dissous N2 dans Nafion #
read pb_C_N2
{
   Conduction
	{
	    equation_non_resolue 0

		diffusion { nafion {
		    diffusivity_fieldname diffusion_nafion
		    por_naf champ_uniforme_morceaux dom_C_N2 1 { defaut 0.0 dom_C_N2_CLa 0.47 dom_C_N2_CLc 0.47 }	# porosite de Couche Active : 0.47, MB: 0 #
            eps_naf champ_uniforme_morceaux dom_C_N2 1 { defaut 1. dom_C_N2_CLa 0.2 dom_C_N2_CLc 0.2	}	# ionomer proportionnel de Nafion: CA 0.2, MB: 1 #
		    }
		}

		# initial_conditions { temperature Champ_fonc_reprise prerun_variant_pb_C_N2.xyz pb_C_N2 temperature last_time } #
		# H_N2 = 6.4e-6*exp(1300*(1./353.15-1./298.15)) = 3.245378361677286e-06; Ceq = cRTH=34*8.314*353.15*H_N2=0.324 #
		initial_conditions { temperature champ_uniforme 1 0.324 }

		boundary_conditions {
			Gauche  paroi_adiabatique
			Droit   paroi_adiabatique
			Haut    paroi_adiabatique
			Bas     paroi_adiabatique
		}

		sources {
		    # source term comming from the diffusion flux of gaz S = diffu * gamma_CL / e_ionomer *(Ceq - C) #
		    Source_Term_Nafion_diffusion
		    {
		        nom_espece N2           # in the list of H2 O2 N2 vap #
		        nom_domaine dom_C_N2
		        nom_CLc dom_C_N2_CLc
		        nom_CLa dom_C_N2_CLa
		        por_naf champ_uniforme_morceaux dom_C_N2 1 { defaut 0.0 dom_C_N2_CLa 0.47 dom_C_N2_CLc 0.47 }	# porosite de Couche Active : 0.47, MB: 0 #
                eps_naf champ_uniforme_morceaux dom_C_N2 1 { defaut 1.  dom_C_N2_CLa 0.2  dom_C_N2_CLc 0.2	}	# ionomer proportionnel de Nafion: CA 0.2, MB: 1 #
		        gamma_CL champ_uniforme_morceaux dom_C_N2 1 { defaut 0.0 dom_C_N2_CLa 1.67e7 dom_C_N2_CLc 2.5e7 }
		        C_SO3 2036.
		        nom_pb_C pb_C_N2
		        nom_champ_C temperature
		        nom_champ_D D_i_naf # champ de diffusion #
		        nom_pb_T pb_T
		        nom_champ_T temperature
		        nom_pb_ci_cathode pb_ci_cathode         # ATTENTION: with H2O need both CL_a and CL_c #
		        nom_champ_ci_cathode concentration      # H2O dans la liste multi-especes O2 vap N2 #
		        nom_pb_ci_anode pb_ci_anode             # ATTENTION: with H2O need both CL_a and CL_c #
		        nom_champ_ci_anode concentration        # H2O dans la liste multi-especes H2 vap N2 #
		    }
        }
    }
    Post_processing
	{
	    probes {
	         Cn_seg temperature periode 1e-3 segment 46 10e-6 -10e-6 10e-6 35e-6
	         Cn_pts temperature periode 1e-3 points 1 10e-6 12.5e-6
	    }
        Definition_champs
	    {
		    Diffusion_N2 operateur_eqn { numero_op 0 source refchamp { pb_champ pb_C_N2 temperature } }
		    Sa_N2  operateur_eqn { numero_source 0 source refchamp {  pb_champ pb_C_N2 temperature } }
	    }
        format lml
        fields dt_post 10
		{
		    temperature elem
		    Diffusion_N2 elem
		    Sa_N2 elem
		    Ceq elem
		}
	}
}


# diffusion multi-especes H2 vap N2 dans GDL-MPL-CL anode #
read pb_ci_anode
{
    Navier_Stokes_standard
	{
	    equation_non_resolue 1
	 	solveur_pression petsc cholesky { }
        projection_initiale 0
		convection { amont }
		diffusion { }
		initial_conditions
		{
			vitesse Champ_Uniforme 2 0. 0.
		}
		boundary_conditions
		{
			Haut    Paroi_fixe
			Droit	Paroi_fixe
			Bas	    Paroi_fixe
			Gauche	Paroi_fixe
		}

	}
	Convection_diffusion_Concentration
	{
	    equation_non_resolue 0

		diffusion { pemfc { diffusivity_fieldname pemfc_cas2 } }
		convection { negligeable }
		initial_conditions
		{
			concentration Champ_Fonc_XYZ dom_ci_anode 3 30. 6. 13.
			# concentration champ_fonc_reprise transport_anode_pb_ci_anode.xyz pb_ci_anode concentration last_time #
		}
		boundary_conditions
		{
			   Haut	  Paroi # flux null #
			   Droit  Paroi
			   Gauche Paroi
			   Bas    Scalaire_impose_paroi Champ_Front_uniforme 3 30. 6. 13.
		}
		Sources
		{
		    Young_Todd_Source_multi {
		        nom_domaine dom_ci_anode
		        nom_ssz_CLa dom_ci_anode_CLa
		        por_naf champ_uniforme_morceaux dom_ci_anode 1 { defaut 0.63 dom_ci_anode_CLa 0.47 } # porosite #
		        eps_naf champ_uniforme_morceaux dom_ci_anode 1 { defaut 0.0 dom_ci_anode_CLa 0.2 }     # ionomer portion #
		        gamma_CL champ_uniforme_morceaux dom_ci_anode 1 { defaut 0.0 dom_ci_anode_CLa 1.67e7 }     #  #
		        nom_pb_C_ci pb_ci_anode
		        nom_champ_ci concentration
		        nom_pb_C_X2 pb_C_H2
		        nom_champ_C_X2 temperature
		        nom_champ_D_X2 D_i_naf
		        nom_pb_C_vap pb_C_H2O
		        nom_champ_C_vap temperature
		        nom_champ_D_vap D_i_naf
		        nom_pb_C_N2 pb_C_N2
		        nom_champ_C_N2 temperature
		        nom_champ_D_N2 D_i_naf
		        nom_pb_T pb_T
		        nom_champ_T temperature
		    }
		}
	}
	Post_processing
    {
        probes {
              c_pts concentration periode 1e-3 points 1 10e-6 25e-6
        }
	    Definition_champs
	    {
		    diffusion_matrice_a operateur_eqn { numero_op 0 source refchamp { pb_champ pb_ci_anode concentration } }
		    source_multi_a  operateur_eqn { numero_source 0 source refchamp {  pb_champ pb_ci_anode concentration } }
	    }
      	format lml
        fields dt_post 10
        {
            concentration   elem
            pemfc_cas2      elem
            diffusion_matrice_a elem
            source_multi_a elem
	    }
    }
}


# diffusion multi-especes O2 vap N2 dans GDL-MPL-CL cathode #
read pb_ci_cathode
{
    Navier_Stokes_standard
	{
	    equation_non_resolue 1
	 	solveur_pression petsc cholesky { }
        projection_initiale 0
		convection { amont }
		diffusion { }
		initial_conditions
		{
			vitesse Champ_Uniforme 2 0. 0.
		}
		boundary_conditions
		{
			Haut    Paroi_fixe
			Droit	Paroi_fixe
			Bas	    Paroi_fixe
			Gauche	Paroi_fixe
		}

	}
	Convection_diffusion_Concentration
	{
	    equation_non_resolue 0

		diffusion { pemfc { diffusivity_fieldname pemfc_cas2 } }
		convection { negligeable }
		initial_conditions
		{
			concentration Champ_Fonc_XYZ dom_ci_cathode 3 8. 7. 33.
		}
		boundary_conditions
		{
			   Haut	  Scalaire_impose_paroi Champ_Front_uniforme 3 9. 8. 34.
			   Droit  Paroi
			   Gauche Paroi
			   Bas    Paroi
		}
		Sources
		{
		    Young_Todd_Source_multi {
		        nom_domaine dom_ci_cathode
		        nom_ssz_CLc dom_ci_cathode_CLc
		        por_naf champ_uniforme_morceaux dom_ci_cathode 1 { defaut 0.63 dom_ci_cathode_CLc 0.47 } # porosite #
		        eps_naf champ_uniforme_morceaux dom_ci_cathode 1 { defaut 0.0 dom_ci_cathode_CLc 0.2 }     # ionomer portion #
		        gamma_CL champ_uniforme_morceaux dom_ci_cathode 1 { defaut 0.0 dom_ci_cathode_CLc 2.5e7 }
		        nom_pb_C_ci pb_ci_cathode
		        nom_champ_ci concentration
		        nom_pb_C_X2 pb_C_O2
		        nom_champ_C_X2 temperature
		        nom_champ_D_X2 D_i_naf
		        nom_pb_C_vap pb_C_H2O
		        nom_champ_C_vap temperature
		        nom_champ_D_vap D_i_naf
		        nom_pb_C_N2 pb_C_N2
		        nom_champ_C_N2 temperature
		        nom_champ_D_N2 D_i_naf
		        nom_pb_T pb_T
		        nom_champ_T temperature
		    }
		}

	}
	Post_processing
    {
        probes {
              ci_cathode_seg concentration periode 1e-3 segment 26 10e-6 25e-6 10e-6 275e-6
              ci_cathode_pts concentration periode 1e-3 points 1 10e-6 35e-6
        }
	    Definition_champs
	    {
		    diffusion_matrice_c operateur_eqn { sources { refchamp { pb_champ pb_ci_cathode concentration } } numero_op 0 }
		    source_multi_c  operateur_eqn { numero_source 0 source refchamp {  pb_champ pb_ci_cathode concentration } }
	    }
      	format lml
        fields dt_post 10
        {
            concentration   elem
            pemfc_cas2      elem
            diffusion_matrice_c elem
            source_multi_c elem
	    }
    }

}

Read pb_phi
{
	Conduction
	{
	    equation_non_resolue 0
		diffusion
		{
			transport_ie
			{
			    diffusivity_fieldname kappa             # kappa <- loi_fermeture_transport_ionique #
			    Cdl champ_uniforme_morceaux dom_phi 1 { defaut 1. dom_phi_CLa 10. dom_phi_CLc 10. }
			}
		}
		# the ionic potential is treated such as the temperature #
		initial_conditions { temperature Champ_Uniforme 1 0. }          # !? #

		boundary_conditions {
			Gauche  paroi_adiabatique
			Droit   paroi_adiabatique
			Haut    paroi_adiabatique
			Bas     paroi_adiabatique
		}

		sources {
		    # couplage phi avec psi, T, C_H2, C_O2, C_H2O #
		    Source_Term_pemfc_transport_ionique {
		        nom_ssz_CLc dom_phi_CLc
		        nom_ssz_CLa dom_phi_CLa
		        nom_pb_phi pb_phi
		        nom_champ_ir ir
		        nom_champ_ip ip
		        nom_champ_dir_dphi dirdphi
		        sign 1.
		        Cdl champ_uniforme_morceaux dom_phi 1 { defaut 1. dom_phi_CLa 10. dom_phi_CLc 10. }
		    }
	    }
    }

	Post_processing
	{
	    Probes {
	        phi_seg temperature periode 1e-3 segment 36 10e-6 -10e-6 10e-6 25e-6
	        phi_pts temperature periode 1e-3 points 1 10e-6 0
	    }
	    Definition_champs
	    {
	        diff_i operateur_eqn { numero_op 0 source refchamp {  pb_champ pb_phi temperature } }
		    s_i operateur_eqn { numero_source 0 source refchamp {  pb_champ pb_phi temperature } }
        }
		Format lml
		fields dt_post 10
		{
		    TEMPERATURE ELEM	# ionic potential #
		    s_i elem            # source #
		    diff_i elem         # diffusion #
	        kappa elem
	        I_i elem
	        Erev elem
	        eta elem
	        io elem
	        ir elem
	        Q_reac elem
	        Q_perm elem
		}
	}

}


Read pb_psi
{

	Conduction {
	    equation_non_resolue 0
		diffusion
		{
			transport_ie
			{
			    Cdl champ_uniforme_morceaux dom_psi 1 { defaut 1. dom_psi_CLa 10. dom_psi_CLc 10. }
			}
		}

		initial_conditions {
			# temperature Champ_Uniforme 1 0.7 #
			temperature champ_uniforme_morceaux dom_psi 1 { defaut 0. dom_psi_GDLc 0.7 dom_psi_MPLc 0.7 dom_psi_CLc 0.7 }
		}
		boundary_conditions {
			Gauche    paroi_adiabatique
			Droit     paroi_adiabatique
			Haut      paroi_temperature_imposee Champ_Front_Uniforme 1 0.7
			Bas       paroi_temperature_imposee Champ_Front_Uniforme 1 0.
		 	I_MB_CL_c paroi_adiabatique
		 	I_MB_CL_a paroi_adiabatique
		}
	    sources {
		    # couplage psi avec: phi, T, C_H2, C_O2, C_H2O #
		    Source_Term_pemfc_transport_ionique {
		        nom_ssz_CLc dom_psi_CLc
		        nom_ssz_CLa dom_psi_CLa
		        nom_pb_phi pb_phi
		        nom_champ_ir ir
		        nom_champ_ip ip
		        nom_champ_dir_dphi dirdphi
		        sign -1.
		        Cdl champ_uniforme_morceaux dom_psi 1 { defaut 1. dom_psi_CLa 10. dom_psi_CLc 10. }
		    }
	    }
	}

	Post_processing
	{
	Probes {
	        psi_c_seg temperature periode 1e-3 segment 26 10e-6 25e-6 10e-6 275e-6
	        psi_a_seg temperature periode 1e-3 segment 26 10e-6 -250e-6 10e-6 0
	        psi_a_pts temperature periode 1e-3 points 1 10e-6 25e-6
	    }

	    Definition_champs
	    {
            diff_e operateur_eqn { numero_op 0 source refchamp {  pb_champ pb_psi temperature } }
		    s_e operateur_eqn { numero_source 0 source refchamp {  pb_champ pb_psi temperature } }
	    }
		Format lml
		fields dt_post 10
		{
		    TEMPERATURE ELEM		# electric potential #
		    s_e elem
		    diff_e elem
		    conductivite elem
		}
	}

}


Solve pbc

End
